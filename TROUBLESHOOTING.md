# Устранение проблем с Web UI

## Ошибка ERR_CONNECTION_REFUSED

Если вы видите ошибку "Не удается получить доступ к сайту" или "ERR_CONNECTION_REFUSED", это означает, что сервер не запущен или не слушает на указанном адресе.

### Шаг 1: Проверка зависимостей

Запустите тестовый скрипт для диагностики:

```bash
python test_ui.py
```

Этот скрипт проверит:
- Установлены ли все зависимости
- Правильно ли импортируется модуль
- Запускается ли сервер

### Шаг 2: Проверка установки

Убедитесь, что все зависимости установлены:

```bash
pip install -r requirements.txt
```

Проверьте установку Gradio:

```bash
python -c "import gradio; print(gradio.__version__)"
```

### Шаг 3: Запуск с диагностикой

Запустите UI и внимательно смотрите на вывод в терминале:

```bash
python run_ui.py
```

Или:

```bash
python -m facecrop --ui
```

**Важно:** После запуска в терминале должно появиться сообщение о том, что сервер запущен. НЕ закрывайте окно терминала - сервер должен продолжать работать.

### Шаг 4: Проверка порта

Если порт 7860 занят, используйте другой:

```bash
python -m facecrop --ui --port 7861
```

Затем откройте в браузере: `http://127.0.0.1:7861`

### Шаг 5: Проверка файрвола

На Windows файрвол может блокировать локальные соединения. Попробуйте:

1. Отключить файрвол временно для теста
2. Или разрешить Python через файрвол

### Шаг 6: Альтернативный адрес

Попробуйте использовать `localhost` вместо `127.0.0.1`:

В файле `run_ui.py` измените:
```python
launch_ui(server_name="localhost", server_port=7860)
```

### Что должно быть в терминале при успешном запуске:

```
============================================================
FaceCrop Web UI
============================================================

Запуск сервера на http://127.0.0.1:7860
После запуска откройте этот адрес в браузере

Для остановки нажмите Ctrl+C
============================================================

✓ Gradio версия: 4.x.x
Запуск сервера...
Running on local URL:  http://127.0.0.1:7860

✓ Сервер запущен и работает!
✓ Откройте в браузере: http://127.0.0.1:7860
```

### Частые проблемы:

1. **Сервер не запускается** - проверьте ошибки в терминале
2. **Порт занят** - используйте другой порт с `--port`
3. **Импорт не работает** - убедитесь, что вы в правильной директории
4. **Gradio не установлен** - выполните `pip install gradio`

### Если ничего не помогает:

1. Запустите `python test_ui.py` и пришлите полный вывод
2. Проверьте версию Python: `python --version` (должна быть 3.8+)
3. Попробуйте переустановить зависимости: `pip install --upgrade -r requirements.txt`

